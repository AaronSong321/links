# Microbenchmark stateful counting (Handlers)

# Handlers
fun countAbs() {
    var i = do Get();
    if (i == 0) { i }
    else { do Put(i - 1); countAbs() }
}

handler state(m) {
	case Get(_,k)  -> fun(s) { k(s)(s)  }
	case Put(p,k)  -> fun(s) { k(())(p) }
        case Return(x) -> fun(s) { x }
}

fun runState(s0, comp) {
    state(comp)(s0)
}

fun b(n) {
    var x = runState(n, countAbs);
    ()
}

b(10^7)
