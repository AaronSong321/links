#!/bin/bash

BENCHMARKS=("nim.links" "nimPure.links" "nimgPure.links" "statefulcounting.links" "statefulcountingPure.links" "stateWithLog.links" "stateWithLogPure.links")
NUM_SAMPLES=10
CSV_DIR='csv'
LINKS_CONFIG='measurement-config'
LINKS="/afs/inf.ed.ac.uk/user/s14/s1467124/links-effect-handlers/links"


for b in ${BENCHMARKS[@]}; do
    output="./$CSV_DIR/$b.csv"
    echo "# $(date)" >> $output
done

i=0
while [[ $i -lt $NUM_SAMPLES ]]; do
    let i=i+1
    for b in ${BENCHMARKS[@]}; do
        output="./$CSV_DIR/$b.csv"
	run="$LINKS --config=$LINKS_CONFIG $b"
	result=$($run 2>&1 | grep "run_program .* seconds taken" | sed -r 's/.* ([0-9]+\.[0-9]*).*/\1/')
	echo "$result" >> $output
    done
done

